# ============================================================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# Content Jumpstart API - Week 3 Optimizations
# ============================================================================
# This file contains production-ready settings for deployment.
# Copy to .env and fill in actual values.
#
# SECURITY WARNINGS:
# - NEVER commit .env file with real secrets to version control
# - Generate strong SECRET_KEY using: python -c "import secrets; print(secrets.token_urlsafe(32))"
# - Use environment-specific values for production databases
# - Enable HTTPS in production, disable DEBUG_MODE
# ============================================================================

# ----------------------------------------------------------------------------
# API Configuration
# ----------------------------------------------------------------------------
API_HOST=0.0.0.0
API_PORT=8000
API_TITLE=Content Jumpstart API
API_VERSION=1.0.0

# IMPORTANT: Set to False in production for security
DEBUG_MODE=False

# ----------------------------------------------------------------------------
# CORS (Cross-Origin Resource Sharing)
# ----------------------------------------------------------------------------
# Add production frontend domains
# Example: https://dashboard.yourdomain.com,https://api.yourdomain.com
CORS_ORIGINS=https://your-production-domain.com

# ----------------------------------------------------------------------------
# Database Configuration (PostgreSQL Recommended for Production)
# ----------------------------------------------------------------------------
# PostgreSQL connection string (recommended)
DATABASE_URL=postgresql://username:password@localhost:5432/content_jumpstart

# SQLite (development only - not recommended for production)
# DATABASE_URL=sqlite:///./data/operator.db

# ----------------------------------------------------------------------------
# Database Connection Pool Settings (PostgreSQL Only)
# ----------------------------------------------------------------------------
# Pool size: Number of connections to maintain in the pool
# Recommendation: 20-50 for medium traffic, 50-100 for high traffic
DB_POOL_SIZE=20

# Max overflow: Additional connections beyond pool_size during spikes
# Recommendation: 1-2x pool size (allows burst capacity)
DB_MAX_OVERFLOW=40

# Pool recycle: Recycle connections after N seconds (prevent stale connections)
# Recommendation: 3600 (1 hour) for AWS RDS, 7200 (2 hours) for stable networks
DB_POOL_RECYCLE=3600

# Pool pre-ping: Test connection health before use
# Recommendation: True (detects broken connections, slight overhead)
DB_POOL_PRE_PING=True

# Echo pool: Log all pool operations (debug only)
# Recommendation: False in production (performance overhead)
DB_ECHO_POOL=False

# Pool timeout: Seconds to wait for available connection
# Recommendation: 30 seconds (balance between UX and resource management)
DB_POOL_TIMEOUT=30

# ----------------------------------------------------------------------------
# Cache Configuration (Week 3)
# ----------------------------------------------------------------------------
# Cache TTL (Time To Live) in seconds
# Short tier: Frequently changing data (e.g., active project lists)
CACHE_TTL_SHORT=300

# Medium tier: Moderately stable data (e.g., client lists)
CACHE_TTL_MEDIUM=600

# Long tier: Rarely changing data (e.g., template library)
CACHE_TTL_LONG=3600

# Cache size limits (max entries per tier)
# Recommendation: 1000 entries per tier for medium traffic
CACHE_MAX_SIZE_SHORT=1000
CACHE_MAX_SIZE_MEDIUM=1000
CACHE_MAX_SIZE_LONG=1000

# Cache statistics tracking
# Recommendation: True (minimal overhead, valuable for monitoring)
CACHE_ENABLE_STATS=True

# ----------------------------------------------------------------------------
# Query Profiling Configuration (Week 3)
# ----------------------------------------------------------------------------
# Slow query threshold (milliseconds)
# Queries exceeding this are flagged as slow
# Recommendation: 100ms for most applications
QUERY_PROFILING_SLOW_THRESHOLD_MS=100

# Very slow query threshold (milliseconds)
# Queries exceeding this are flagged as critical
# Recommendation: 500ms for critical alerts
QUERY_PROFILING_VERY_SLOW_THRESHOLD_MS=500

# Query profiling enabled
# Recommendation: True in production for performance monitoring
QUERY_PROFILING_ENABLED=True

# Max samples to keep per query pattern
# Recommendation: 100 samples (circular buffer prevents memory bloat)
QUERY_PROFILING_MAX_SAMPLES=100

# Query profiling retention (seconds)
# How long to keep profiling data
# Recommendation: 86400 (24 hours) for recent analysis
QUERY_PROFILING_RETENTION_SECONDS=86400

# ----------------------------------------------------------------------------
# Health Check Configuration (Week 3)
# ----------------------------------------------------------------------------
# Health check intervals (seconds)
# How often to run automated health checks
# Recommendation: 60 seconds for production monitoring
HEALTH_CHECK_INTERVAL_SECONDS=60

# Health check timeout (seconds)
# Maximum time for health check to complete
# Recommendation: 10 seconds
HEALTH_CHECK_TIMEOUT_SECONDS=10

# Cache hit rate thresholds (percentage)
# Warnings triggered below these thresholds
CACHE_HIT_RATE_WARNING_THRESHOLD=50
CACHE_HIT_RATE_CRITICAL_THRESHOLD=30

# Database pool utilization thresholds (percentage)
# Warnings triggered above these thresholds
DB_POOL_UTILIZATION_WARNING_THRESHOLD=70
DB_POOL_UTILIZATION_CRITICAL_THRESHOLD=90

# Query slow percentage threshold (percentage of total queries)
# Warnings triggered above these thresholds
QUERY_SLOW_PERCENTAGE_WARNING_THRESHOLD=10
QUERY_SLOW_PERCENTAGE_CRITICAL_THRESHOLD=25

# ----------------------------------------------------------------------------
# JWT Authentication
# ----------------------------------------------------------------------------
# CRITICAL: Generate strong secret key for production
# Use: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=REPLACE_WITH_SECURE_RANDOM_STRING_IN_PRODUCTION

# JWT algorithm (HS256 recommended for symmetric key)
ALGORITHM=HS256

# Access token expiration (minutes)
# Recommendation: 30 minutes for security, 60 for UX
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Refresh token expiration (days)
# Recommendation: 7 days (balance security and user convenience)
REFRESH_TOKEN_EXPIRE_DAYS=7

# ----------------------------------------------------------------------------
# Anthropic API
# ----------------------------------------------------------------------------
# CRITICAL: Use production API key with appropriate rate limits
ANTHROPIC_API_KEY=sk-ant-your-production-key-here

# Model selection
# Recommendation: claude-3-5-sonnet-20241022 for balanced performance/cost
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# ----------------------------------------------------------------------------
# Rate Limiting
# ----------------------------------------------------------------------------
# Rate limits set to 70% of Anthropic limits to allow headroom
# Adjust based on your Anthropic tier and expected traffic

# Requests per minute
# Anthropic limit: 4000 RPM (Tier 2), 2800 = 70%
RATE_LIMIT_REQUESTS_PER_MINUTE=2800

# Tokens per minute
# Anthropic limit: 400,000 TPM (Tier 2), 280,000 = 70%
RATE_LIMIT_TOKENS_PER_MINUTE=280000

# Queue size for rate limiter
# Recommendation: 100 requests (prevents memory bloat)
RATE_LIMIT_QUEUE_SIZE=100

# Rate limit window (seconds)
# Recommendation: 60 seconds (aligns with per-minute limits)
RATE_LIMIT_WINDOW_SECONDS=60

# ----------------------------------------------------------------------------
# Content Generation
# ----------------------------------------------------------------------------
# Parallel generation enabled
# Recommendation: True for production (4x faster generation)
PARALLEL_GENERATION=True

# Max concurrent API calls
# Recommendation: 5 for Tier 2, 10 for Tier 3+
# Balance: More concurrency = faster but higher rate limit risk
MAX_CONCURRENT_API_CALLS=5

# Generation timeout (seconds)
# Max time for entire generation job
# Recommendation: 300 seconds (5 minutes for 30 posts)
GENERATION_TIMEOUT_SECONDS=300

# Single post timeout (seconds)
# Max time for single post generation
# Recommendation: 30 seconds
POST_GENERATION_TIMEOUT_SECONDS=30

# Retry configuration
# Max retries for failed API calls
MAX_GENERATION_RETRIES=3

# Retry backoff (seconds)
# Initial delay before retry (exponential backoff)
RETRY_INITIAL_DELAY_SECONDS=1

# ----------------------------------------------------------------------------
# File Upload
# ----------------------------------------------------------------------------
# Max upload size (MB)
# Recommendation: 10 MB for client briefs
MAX_UPLOAD_SIZE_MB=10

# Allowed brief file extensions
# Recommendation: .txt, .md for text briefs
ALLOWED_BRIEF_EXTENSIONS=.txt,.md

# Max brief file size (KB)
# Recommendation: 500 KB (prevents abuse)
MAX_BRIEF_SIZE_KB=500

# ----------------------------------------------------------------------------
# Paths (Absolute paths recommended for production)
# ----------------------------------------------------------------------------
# Briefs directory
BRIEFS_DIR=/var/www/content-jumpstart/data/briefs

# Outputs directory
OUTPUTS_DIR=/var/www/content-jumpstart/data/outputs

# Logs directory
LOGS_DIR=/var/www/content-jumpstart/logs

# ----------------------------------------------------------------------------
# Logging
# ----------------------------------------------------------------------------
# Log level
# Recommendation: INFO for production, DEBUG for troubleshooting
LOG_LEVEL=INFO

# Log format
# Recommendation: json for production (structured logging)
LOG_FORMAT=json

# Log rotation
# Recommendation: daily rotation with 30-day retention
LOG_ROTATION=daily
LOG_RETENTION_DAYS=30

# Log max size (MB)
# Recommendation: 100 MB per file
LOG_MAX_SIZE_MB=100

# ----------------------------------------------------------------------------
# Performance & Optimization
# ----------------------------------------------------------------------------
# Worker processes (for gunicorn/uvicorn)
# Recommendation: (2 x CPU cores) + 1
# Example: 4-core server = 9 workers
WORKERS=9

# Worker connections (for uvicorn)
# Recommendation: 1000 for medium traffic
WORKER_CONNECTIONS=1000

# Keepalive timeout (seconds)
# Recommendation: 5 seconds
KEEPALIVE_TIMEOUT=5

# Request timeout (seconds)
# Recommendation: 60 seconds for content generation
REQUEST_TIMEOUT=60

# ----------------------------------------------------------------------------
# Monitoring & Alerting
# ----------------------------------------------------------------------------
# Enable Sentry error tracking (optional)
ENABLE_SENTRY=False
SENTRY_DSN=https://your-sentry-dsn-here

# Enable New Relic APM (optional)
ENABLE_NEW_RELIC=False
NEW_RELIC_LICENSE_KEY=your-new-relic-key-here

# Enable Datadog monitoring (optional)
ENABLE_DATADOG=False
DATADOG_API_KEY=your-datadog-key-here

# Health check endpoint for load balancer
# Recommendation: /health
HEALTH_CHECK_PATH=/health

# ----------------------------------------------------------------------------
# Security Headers
# ----------------------------------------------------------------------------
# Enable HSTS (HTTP Strict Transport Security)
ENABLE_HSTS=True
HSTS_MAX_AGE=31536000

# Enable Content Security Policy
ENABLE_CSP=True

# Enable X-Frame-Options
X_FRAME_OPTIONS=DENY

# Enable X-Content-Type-Options
X_CONTENT_TYPE_OPTIONS=nosniff

# ----------------------------------------------------------------------------
# Backup & Disaster Recovery
# ----------------------------------------------------------------------------
# Database backup schedule
# Recommendation: Daily backups with 30-day retention
DB_BACKUP_ENABLED=True
DB_BACKUP_SCHEDULE=0 2 * * *  # 2 AM daily
DB_BACKUP_RETENTION_DAYS=30

# Backup location
DB_BACKUP_PATH=/var/backups/content-jumpstart

# ----------------------------------------------------------------------------
# Feature Flags (Optional)
# ----------------------------------------------------------------------------
# Enable research tools
ENABLE_RESEARCH_TOOLS=True

# Enable analytics dashboard
ENABLE_ANALYTICS=True

# Enable email notifications
ENABLE_EMAIL_NOTIFICATIONS=False

# Email SMTP settings (if email enabled)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM_EMAIL=noreply@yourdomain.com

# ----------------------------------------------------------------------------
# Environment Metadata
# ----------------------------------------------------------------------------
ENVIRONMENT=production
DEPLOYMENT_TIMESTAMP=2025-12-15T00:00:00Z
VERSION=1.0.0
